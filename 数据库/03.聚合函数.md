# 题单

[620. 有趣的电影](https://leetcode.cn/problems/not-boring-movies/)

[1251. 平均售价](https://leetcode.cn/problems/average-selling-price/)

# 题解

## [620. 有趣的电影](https://leetcode.cn/problems/not-boring-movies/)

```sql
select id, movie, description, rating
from cinema
where description != "boring" and id % 2 = 1
order by rating desc
```

<aside> 💡

常见的判断奇数方式

- mod(x, 2) = 1 ，如果余数是 1 就是奇数。
- power(-1, x) = -1 ， 如果结果是 -1 就是奇数
- x % 2 = 1 ，如果余数是 1 就是奇数。
- x & 1 = 1 ，如果是 1 就是奇数
- x regexp '[1, 3, 5, 7, 9]$' = 1 如果为 1 就是奇数
- x>>1<<1 != x 如果右移一位在左移一位不等于原值，就是奇数 </aside>

## [1251. 平均售价](https://leetcode.cn/problems/average-selling-price/)

```sql
select 
    p.product_id,
    ifnull(round((sum(p.price * u.units) / sum(u.units)), 2), 0) as average_price
from Prices p
left join UnitsSold u 
    on u.product_id = p.product_id 
    and u.purchase_date between p.start_date and p.end_date
group by p.product_id
```

<aside> 💡

复盘

1. 卑鄙的出题者，你业务都0销量了，还搁这算均价，均价还填 0，实在无语，就是为了挖个 ifnull 的坑来恶心一下！
   - 所以**涉及到联表查询的时候，特别是需要计算的时候，切记加上 ifnull 来保险**（前面一节题目也有这种情况，但是 null 的情况出现在示例中，这里没有，于是就忘了，所以联表查询如果 null 有意义需要赋值，一定要考虑用上 ifnull**）**
2. 表之间的关联关系晕乎乎的
   - 我第一次写得时候是 from UnitsSold join Prices，会因为 UnitsSold 是空的，然后没有数据
   - 还是忽略了表描述中的`(product_id，start_date，end_date) 是 prices 表的主键（具有唯一值的列的组合）。`
   - 巧的是我问 AI，AI 也是用 UnitsSold 表连接 Prices 表，所以也会出现漏数据的情况
   - 感觉主要是题目太绕了，而且挖坑恶心人 </aside>