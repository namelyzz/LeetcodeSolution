# é¢˜å•

[620. æœ‰è¶£çš„ç”µå½±](https://leetcode.cn/problems/not-boring-movies/)

[1251. å¹³å‡å”®ä»·](https://leetcode.cn/problems/average-selling-price/)

# é¢˜è§£

## [620. æœ‰è¶£çš„ç”µå½±](https://leetcode.cn/problems/not-boring-movies/)

```sql
select id, movie, description, rating
from cinema
where description != "boring" and id % 2 = 1
order by rating desc
```

<aside> ğŸ’¡

å¸¸è§çš„åˆ¤æ–­å¥‡æ•°æ–¹å¼

- mod(x, 2) = 1 ï¼Œå¦‚æœä½™æ•°æ˜¯ 1 å°±æ˜¯å¥‡æ•°ã€‚
- power(-1, x) = -1 ï¼Œ å¦‚æœç»“æœæ˜¯ -1 å°±æ˜¯å¥‡æ•°
- x % 2 = 1 ï¼Œå¦‚æœä½™æ•°æ˜¯ 1 å°±æ˜¯å¥‡æ•°ã€‚
- x & 1 = 1 ï¼Œå¦‚æœæ˜¯ 1 å°±æ˜¯å¥‡æ•°
- x regexp '[1, 3, 5, 7, 9]$' = 1 å¦‚æœä¸º 1 å°±æ˜¯å¥‡æ•°
- x>>1<<1 != x å¦‚æœå³ç§»ä¸€ä½åœ¨å·¦ç§»ä¸€ä½ä¸ç­‰äºåŸå€¼ï¼Œå°±æ˜¯å¥‡æ•° </aside>

## [1251. å¹³å‡å”®ä»·](https://leetcode.cn/problems/average-selling-price/)

```sql
select 
    p.product_id,
    ifnull(round((sum(p.price * u.units) / sum(u.units)), 2), 0) as average_price
from Prices p
left join UnitsSold u 
    on u.product_id = p.product_id 
    and u.purchase_date between p.start_date and p.end_date
group by p.product_id
```

<aside> ğŸ’¡

å¤ç›˜

1. å‘é„™çš„å‡ºé¢˜è€…ï¼Œä½ ä¸šåŠ¡éƒ½0é”€é‡äº†ï¼Œè¿˜æè¿™ç®—å‡ä»·ï¼Œå‡ä»·è¿˜å¡« 0ï¼Œå®åœ¨æ— è¯­ï¼Œå°±æ˜¯ä¸ºäº†æŒ–ä¸ª ifnull çš„å‘æ¥æ¶å¿ƒä¸€ä¸‹ï¼
   - æ‰€ä»¥**æ¶‰åŠåˆ°è”è¡¨æŸ¥è¯¢çš„æ—¶å€™ï¼Œç‰¹åˆ«æ˜¯éœ€è¦è®¡ç®—çš„æ—¶å€™ï¼Œåˆ‡è®°åŠ ä¸Š ifnull æ¥ä¿é™©**ï¼ˆå‰é¢ä¸€èŠ‚é¢˜ç›®ä¹Ÿæœ‰è¿™ç§æƒ…å†µï¼Œä½†æ˜¯ null çš„æƒ…å†µå‡ºç°åœ¨ç¤ºä¾‹ä¸­ï¼Œè¿™é‡Œæ²¡æœ‰ï¼Œäºæ˜¯å°±å¿˜äº†ï¼Œæ‰€ä»¥è”è¡¨æŸ¥è¯¢å¦‚æœ null æœ‰æ„ä¹‰éœ€è¦èµ‹å€¼ï¼Œä¸€å®šè¦è€ƒè™‘ç”¨ä¸Š ifnull**ï¼‰**
2. è¡¨ä¹‹é—´çš„å…³è”å…³ç³»æ™•ä¹ä¹çš„
   - æˆ‘ç¬¬ä¸€æ¬¡å†™å¾—æ—¶å€™æ˜¯ from UnitsSold join Pricesï¼Œä¼šå› ä¸º UnitsSold æ˜¯ç©ºçš„ï¼Œç„¶åæ²¡æœ‰æ•°æ®
   - è¿˜æ˜¯å¿½ç•¥äº†è¡¨æè¿°ä¸­çš„`(product_idï¼Œstart_dateï¼Œend_date) æ˜¯ prices è¡¨çš„ä¸»é”®ï¼ˆå…·æœ‰å”¯ä¸€å€¼çš„åˆ—çš„ç»„åˆï¼‰ã€‚`
   - å·§çš„æ˜¯æˆ‘é—® AIï¼ŒAI ä¹Ÿæ˜¯ç”¨ UnitsSold è¡¨è¿æ¥ Prices è¡¨ï¼Œæ‰€ä»¥ä¹Ÿä¼šå‡ºç°æ¼æ•°æ®çš„æƒ…å†µ
   - æ„Ÿè§‰ä¸»è¦æ˜¯é¢˜ç›®å¤ªç»•äº†ï¼Œè€Œä¸”æŒ–å‘æ¶å¿ƒäºº </aside>



```sql
select 
    p.project_id,
    ifnull(round((sum(e.experience_years) / count(p.project_id)), 2), 0.00) as average_years
from Project p
left join Employee e on p.employee_id = e.employee_id
group by project_id
```



```sql
select 
    r.contest_id,
    ifnull(
        round(
            ((count(r.user_id) / (select count(*) from Users)) * 100), 2
        ), 0.00
    ) as percentage
from Register r
left join Users u on r.user_id = u.user_id
group by r.contest_id
order by percentage desc, r.contest_id
```

ifnull PTSD ç»™æˆ‘æŠ˜ç£¨é€äº†

æˆ‘èƒ½æƒ³åˆ°ç›´æ¥é™¤ä»¥Usersè¡¨çš„æ€»æ•°ï¼Œä½†æ˜¯èƒ½å¦åœ¨æŸ¥è¯¢è¯­å¥ä¸­å†™ä¸€ä¸ªè¯­å¥æˆ‘å°±ä¸å¤ªç¡®å®šï¼Œè¯•ä¸€ä¸‹è¿˜æ˜¯å¯ä»¥çš„



```sql
select
    query_name,
    ifnull(round(avg(rating/position), 2), 0.00) as quality,
    ifnull(round(avg(rating < 3) * 100, 2), 0.00) as poor_query_percentage
from Queries
group by query_name
```



```sql
select
    date_format(trans_date, "%Y-%m") as month,
    country,
    count(state) as trans_count,
    sum(if(state="approved", 1, 0)) as approved_count,
    sum(amount) as trans_total_amount,
    sum(if(state="approved", amount, 0)) as approved_total_amount
from Transactions
group by month, country
```



```sql
select
    round(
        (sum(order_date=customer_pref_delivery_date) / count(*)) * 100, 2
    ) as immediate_percentage
from Delivery
where (customer_id, order_date) in (
    select customer_id, min(order_date) as order_date
    from Delivery
    group by customer_id
)
```

æ€è·¯ï¼š

1. æ‰¾åˆ°æœ€æ—©çš„è®¢å•ï¼Œä½œä¸ºå­è¡¨
2. æ ¹æ®å­è¡¨ï¼Œåˆ¤æ–­ä¸€ä¸‹å³æ—¶è®¢å•ï¼Œç„¶åé™¤ä»¥æ€»æ•°ï¼Œåˆ™çŸ¥é“äº†å³æ—¶è®¢å•ç‡



è¿™é¢˜ä¸ä¼šï¼ŒæŠ„çš„ï¼ˆåŠ äº†ä¸ª ifnullï¼‰

```sql
select 
    ifnull(
        round(
           count(distinct player_id) / (select count(distinct player_id) from Activity) , 2
        ), 0.00
    ) as fraction
from Activity
where (player_id, event_date) in (
    select player_id, min(event_date) + interval 1 day
    from Activity
    group by player_id
)
```

<aside> ğŸ’¡

1. æœ‰ç›¸åŒçš„æƒ³æ³•ï¼Œç±»ä¼¼ä¸ä¸Šä¸€é¢˜ï¼Œä½†æ˜¯ä¸çŸ¥é“æ€ä¹ˆæ±‚é¦–æ¬¡ç™»å½•ä¸‹ä¸€å¤©æ˜¯å¦è¿˜ç™»é™†
   1. ç”¨äº†ä¸€ä¸ª interval 1 dayï¼Œè¿™ä¸ªç”¨æ³•æˆ‘ä¸æ‡‚ï¼Œå­¦åˆ°äº†
2. count çš„æ—¶å€™ç”¨äº† distinctï¼Œæˆ‘è‡ªå·±å¾ˆå°‘åŠ è¿™ä¸ªï¼Œæˆ‘çœ‹åˆ°å¾ˆå¤šäººä¼šåŠ ï¼Œä½†æ˜¯æœ‰æ—¶å€™ä¸åŠ ä¹Ÿèƒ½è¿‡ç”¨ä¾‹ï¼Œæ„Ÿè§‰å¯èƒ½ä¹Ÿæ˜¯ä»€ä¹ˆ distinct ptsdï¼Œä¸è¿‡æˆ‘è§‰å¾—æœ€å¥½äº†è§£ä¸€ä¸‹ï¼Œæ˜ç¡®ä»€ä¹ˆæ—¶å€™è¯¥åŠ ï¼Œæˆ–è€…æ˜¯ä¸æ˜¯å’Œ ifnull ä¸€æ ·åŠ ä¸Šæœ‰å¥½å¤„ </aside>